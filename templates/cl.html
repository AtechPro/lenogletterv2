<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acknowledgement Letter Form</title>
    <link rel="stylesheet" href="/static/form.css">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='icons/lenogweb.ico') }}">

</head>
<body>
    <div class="container">
        <h1>Cover Letter</h1>
        <form method="POST" action="/cl" class="form">
            <div class="form-group">
                <label for="reference_no">Reference No:</label>
                <input type="text" id="reference_no" name="reference_no" required>
            </div>

            <div class="form-group">
                <label for="contract_title">Contract Title:</label>
                <input type="text" id="contract_title" name="contract_title" required>
            </div>

            <div class="form-group">
                <label for="subject">Subject:</label>
                <input type="text" id="subject" name="subject" required>
            </div>

            <div class="form-group">
                <label>Documents:</label>
                <div id="document-checkboxes">
                    <!-- Predetermined and dynamically added documents will appear here -->
                </div>
                
                <div class="add-document-section">
                    <input type="text" id="new-document" placeholder="Add a new document...">
                    <button type="button" id="add-document-btn">Add</button>
                </div>
                <div id="notification" class="notification"></div>
            </div>

            <div class="form-group">
                <label for="contact_name">Contact Name:</label>
                <select id="contact_name" name="contact_name" required>
                    <option value="Dwayne Marshall Labangka">Dwayne Marshall Labangka</option>
                    <option value="Cheok Jia Jun">Cheok Jia Jun</option>
                    <option value="Sao Lip Zhou">Sao Lip Zhou</option>
                    <option value="Asmin Mandja">Asmin Mandja</option>
                    <option value="Mohd Suhailin Siman">Mohd Suhailin Siman</option>
                </select>
            </div>

            <div class="form-group">
                <label for="designation">Designation:</label>
                <select id="designation" name="designation" required>
                    <option value="Project Manager">Project Manager</option>
                    <option value="Technical Manager">Technical Manager</option>
                    <option value="Technical Engineer">Technical Engineer</option>
                    <option value="Managing Director">Managing Director</option>
                    <option value="Operation Manager">Operation Manager</option>
                </select>
            </div>

            <button type="submit" class="submit-button">Generate Letter</button>
        </form>
    </div>

    <script>
        // Predetermined documents
        const predeterminedDocuments = [
            "Cover letter for technical proposal",
            "Exhibit I (Scope of Work)",
            "Exhibit III (Unpriced schedule of rates)",
            "HSE Documents",
            "Key Personnel CV / Resume",
            "Company Experience",
            "Letter of compliance to Scope of Work",
            "Letter of compliance to Terms and Condition of Contracts",
            "Agency Letter"
        ];

        // Function to add a document to the form
        function addDocumentToForm(docValue, autoCheck = false) {
            const docId = 'doc-' + Date.now();

            // Create new checkbox element
            const checkboxDiv = document.createElement('div');
            checkboxDiv.className = 'checkbox-item';

            // Create the input element
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.name = 'documents[]';
            checkbox.value = docValue;
            checkbox.id = docId;
            checkbox.checked = autoCheck; // Auto-tick the checkbox if specified

            // Create the label
            const label = document.createElement('label');
            label.htmlFor = docId;
            label.textContent = docValue;

            // Add elements to the form
            checkboxDiv.appendChild(checkbox);
            checkboxDiv.appendChild(label);
            document.getElementById('document-checkboxes').appendChild(checkboxDiv);

            // Highlight the new document briefly
            checkboxDiv.style.backgroundColor = '#f0f8ff';
            setTimeout(() => {
                checkboxDiv.style.backgroundColor = '';
            }, 1000);
        }

        // Load saved documents from localStorage on page load
        document.addEventListener('DOMContentLoaded', function () {
            // Retrieve saved documents from localStorage
            const savedDocuments = JSON.parse(localStorage.getItem('documents')) || [];

            // Combine predetermined and saved documents, ensuring no duplicates
            const allDocuments = [...new Set([...predeterminedDocuments, ...savedDocuments])];

            // Add all documents to the form
            allDocuments.forEach(doc => {
                addDocumentToForm(doc);
            });
        });

        // Add event listener for the "Add" button
        document.getElementById('add-document-btn').addEventListener('click', function () {
            const newDocValue = document.getElementById('new-document').value.trim();
            if (newDocValue) {
                // Check if the document already exists
                const existingDocuments = document.querySelectorAll('#document-checkboxes input[type="checkbox"]');
                const isDuplicate = Array.from(existingDocuments).some(checkbox => checkbox.value === newDocValue);

                if (isDuplicate) {
                    showNotification("This document already exists in the list.");
                    return;
                }

                // Add the new document to the form and auto-check it
                addDocumentToForm(newDocValue, true);

                // Save the updated list to localStorage
                const savedDocuments = JSON.parse(localStorage.getItem('documents')) || [];
                savedDocuments.push(newDocValue);

                // Ensure no duplicates in localStorage
                const uniqueDocuments = [...new Set(savedDocuments)];
                localStorage.setItem('documents', JSON.stringify(uniqueDocuments));

                // Clear the input field
                document.getElementById('new-document').value = '';

                // Show success notification
                showNotification("Document added successfully!");
            } else {
                showNotification("Please enter a valid document name.");
            }
        });

        // Function to show notifications
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000); // Hide after 3 seconds
        }
    </script>
</body>
</html>